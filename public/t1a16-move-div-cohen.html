<!DOCTYPE html>
<html lang="en">
<head>
  <title>t1a16-move-div-cohen.html</title>
  <meta charset="UTF-8">
  <style>
    body {
      background: #eef;
      font-family: Arial, sans-serif;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    h1 { text-align: center; }
    .obj {
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 10px;
      text-align: center;
      line-height: 50px;
      color: white;
      font-weight: bold;
    }
    #obj1 { background: red;   left: 50px;  top: 200px; }
    #obj2 { background: blue;  left: 250px; top: 300px; }
    #obj3 { background: green; left: 400px; top: 350px; }
    #obj4 { background: orange;left: 550px; top: 400px; }
    #obj5 { background: purple;left: 250px; top: 150px; }
    #obj6 { background: brown; left: 400px; top: 200px; }
    #obj7 { background: teal;  left: 600px; top: 250px; }
    #obj8 { background: black; left: 700px; top: 350px; }
  </style>
</head>
<body>
  <h1>t1a16-move-div-cohen.html</h1>
  <p style="text-align:center;">Use arrow keys to move the red box — objects bounce and push apart smoothly!</p>

  <!-- 8 objects -->
  <div id="obj1" class="obj">1</div>
  <div id="obj2" class="obj">2</div>
  <div id="obj3" class="obj">3</div>
  <div id="obj4" class="obj">4</div>
  <div id="obj5" class="obj">5</div>
  <div id="obj6" class="obj">6</div>
  <div id="obj7" class="obj">7</div>
  <div id="obj8" class="obj">8</div>

  <div style="text-align:center; margin-top:620px;">
    <button onclick="startAll()">▶ Start All</button>
    <button onclick="stopAll()">⏸ Stop All</button>
  </div>

  <script>
    let myTimers = [];
    let angles = Array(8).fill(0);
    let playerSpeed = 10;

    // Objects that move and collide
    const movers = ['obj1', 'obj2', 'obj3', 'obj4'];
    const speeds = {
      obj1: { dx: 0, dy: 0 }, // player controlled
      obj2: { dx: 3, dy: 2 },
      obj3: { dx: -3, dy: 3 },
      obj4: { dx: 4, dy: -2 }
    };

    function getNum(val) { return parseInt(val || 0); }

    function getRect(el) {
      return {
        x: getNum(el.style.left),
        y: getNum(el.style.top),
        w: el.offsetWidth,
        h: el.offsetHeight
      };
    }

    // Check for collision and push apart
    function resolveCollision(idA, idB) {
      const a = document.getElementById(idA);
      const b = document.getElementById(idB);

      const ra = getRect(a);
      const rb = getRect(b);

      if (
        ra.x < rb.x + rb.w &&
        ra.x + ra.w > rb.x &&
        ra.y < rb.y + rb.h &&
        ra.y + ra.h > rb.y
      ) {
        // Calculate overlap
        const overlapX = (ra.x + ra.w / 2) - (rb.x + rb.w / 2);
        const overlapY = (ra.y + ra.h / 2) - (rb.y + rb.h / 2);
        const halfW = (ra.w + rb.w) / 2;
        const halfH = (ra.h + rb.h) / 2;

        if (Math.abs(overlapX) < halfW && Math.abs(overlapY) < halfH) {
          const offsetX = (halfW - Math.abs(overlapX)) * (overlapX > 0 ? 1 : -1);
          const offsetY = (halfH - Math.abs(overlapY)) * (overlapY > 0 ? 1 : -1);

          // Push apart
          a.style.left = getNum(a.style.left) + offsetX / 2 + 'px';
          a.style.top  = getNum(a.style.top)  + offsetY / 2 + 'px';
          b.style.left = getNum(b.style.left) - offsetX / 2 + 'px';
          b.style.top  = getNum(b.style.top)  - offsetY / 2 + 'px';

          // Swap or invert velocities
          const temp = { ...speeds[idA] };
          speeds[idA].dx = -speeds[idB].dx;
          speeds[idA].dy = -speeds[idB].dy;
          speeds[idB].dx = -temp.dx;
          speeds[idB].dy = -temp.dy;
        }
      }
    }

    function moveBounce(id) {
      const el = document.getElementById(id);
      let x = getNum(el.style.left);
      let y = getNum(el.style.top);
      let { dx, dy } = speeds[id];

      x += dx;
      y += dy;

      // Wall bounce
      if (x < 0) { x = 0; dx *= -1; }
      if (x > window.innerWidth - 60) { x = window.innerWidth - 60; dx *= -1; }
      if (y < 0) { y = 0; dy *= -1; }
      if (y > window.innerHeight - 60) { y = window.innerHeight - 60; dy *= -1; }

      el.style.left = x + 'px';
      el.style.top  = y + 'px';
      speeds[id] = { dx, dy };
    }

    function moveCircle(id, cx, cy, radius, speed, index) {
      const el = document.getElementById(id);
      angles[index] += speed;
      el.style.left = cx + radius * Math.cos(angles[index]) + 'px';
      el.style.top  = cy + radius * Math.sin(angles[index]) + 'px';
    }

    function checkAllCollisions() {
      for (let i = 0; i < movers.length; i++) {
        for (let j = i + 1; j < movers.length; j++) {
          resolveCollision(movers[i], movers[j]);
        }
      }
    }

    function startAll() {
      stopAll();

      // Movement timers
      myTimers.push(setInterval(() => {
        moveBounce('obj2');
        moveBounce('obj3');
        moveBounce('obj4');
        checkAllCollisions();
      }, 30));

      // Decorations
      myTimers.push(setInterval(() => moveCircle('obj5', 400, 300, 150, 0.1, 4), 50));
      let r6 = 20;
      myTimers.push(setInterval(() => {
        moveCircle('obj6', 600, 400, r6, 0.15, 5);
        r6 += 0.3;
        if (r6 > 200) r6 = 20;
      }, 50));

      myTimers.push(setInterval(() => {
        const el = document.getElementById('obj7');
        el.style.left = Math.random() * (window.innerWidth - 60) + 'px';
        el.style.top  = Math.random() * (window.innerHeight - 60) + 'px';
      }, 300));

      let x8 = 0;
      myTimers.push(setInterval(() => {
        const el = document.getElementById('obj8');
        x8 += 5;
        el.style.left = (x8 % (window.innerWidth - 60)) + 'px';
        el.style.top  = 400 + 100 * Math.sin(x8 / 50) + 'px';
      }, 50));
    }

    function stopAll() {
      myTimers.forEach(clearInterval);
      myTimers = [];
    }

    // Arrow keys control red box (obj1)
    window.addEventListener('keydown', (e) => {
      const el = document.getElementById('obj1');
      let x = getNum(el.style.left);
      let y = getNum(el.style.top);

      if (e.key === 'ArrowRight') x += playerSpeed;
      if (e.key === 'ArrowLeft')  x -= playerSpeed;
      if (e.key === 'ArrowUp')    y -= playerSpeed;
      if (e.key === 'ArrowDown')  y += playerSpeed;

      x = Math.max(0, Math.min(x, window.innerWidth - 60));
      y = Math.max(0, Math.min(y, window.innerHeight - 60));

      el.style.left = x + 'px';
      el.style.top  = y + 'px';
    });
  </script>
</body>
</html>
